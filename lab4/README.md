# 实验四：IP数据报的收发与转发

## 简介

本实验通过在虚拟机环境中模拟多主机间的UDP数据报收发与转发，深入理解IP数据报的路由过程。实验内容涵盖了单网口主机的IP数据转发、基于转发表的扩展以及双网口主机的路由转发。

## 文件结构

- `CSNet_4_1/`: 多主机间的UDP数据报收发与转发。
  - `CSNet_4_1_A/`: 发送端主机。
  - `CSNet_4_1_B/`: 转发主机。
  - `CSNet_4_1_C/`: 接收端主机。
- `CSNet_4_2/`: 基于单网口主机的IP数据转发（扩展至5台主机）。
  - `CSNet_4_2_A/`: 发送端。
  - `CSNet_4_2_B/`, `CSNet_4_2_C/`, `CSNet_4_2_D/`: 转发主机。
  - `CSNet_4_2_E/`: 接收端。
- `CSNet_4_3/`: 基于双网口主机的路由转发。
  - `4_3_A/`: 主机A，位于一个子网。
  - `4_3_B/`: 路由器（双网口主机），连接两个子网。
  - `4_3_C/`: 主机C，位于另一个子网。

每个节点目录下都包含 `go.mod` 和 `main.go` 文件，用于运行该节点的模拟程序。

## 功能与实现

### 1. UDP数据报收发与转发 (`CSNet_4_1`)
- **主机A** (`CSNet_4_1_A`): 从控制台读取用户输入，将消息通过UDP发送给主机B。
- **主机B** (`CSNet_4_1_B`): 接收来自主机A的UDP包，并将其转发给主机C。
- **主机C** (`CSNet_4_1_C`): 接收来自主机B的UDP包，并显示消息内容。

### 2. 基于单网口主机的IP数据转发 (`CSNet_4_2`)
- 模拟IP数据报的路由过程，使用原始套接字（raw socket）手动构造以太网帧、IP头部和UDP头部。
- 网络规模扩展到5台主机（A->B->C->D->E），通过转发表实现通用性。
- 每个转发节点（B, C, D）根据目的IP地址修改以太网帧的MAC地址，实现逐跳转发。

### 3. 基于双网口主机的路由转发 (`CSNet_4_3`)
- **主机B** (`4_3_B`)作为路由器，拥有两个网络接口，连接两个不同的子网。
- **主机A** (`4_3_A`) 和 **主机C** (`4_3_C`) 分别位于不同的子网。
- 实现了静态路由表，主机B根据目的IP地址查询路由表，在不同的网络接口间转发数据包，实现了跨子网通信和双向传输。

## 如何运行

以`CSNet_4_3`为例：
1. 在三台虚拟机上分别进入对应的目录（`4_3_A`, `4_3_B`, `4_3_C`）。
2. 配置好每台虚拟机的网络接口和IP地址。
3. 在每个目录中，以管理员权限运行以下命令启动节点：
   ```bash
   sudo go run main.go
   ```
4. 在主机A的控制台输入消息，可以观察到消息通过主机B转发到主机C，并且主机C的回复也能成功返回到主机A。

## 仓库所有者

[XePWang](https://github.com/XePWang)
